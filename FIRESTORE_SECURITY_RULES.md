# Firestore ë³´ì•ˆ ê·œì¹™ ì„¤ì • ê°€ì´ë“œ

## âš ï¸ ì¤‘ìš”: í…ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œ í”„ë¡œë•ì…˜ ëª¨ë“œë¡œ ë³€ê²½ í•„ìˆ˜!

í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹œì‘í•œ ê²½ìš°, **30ì¼ í›„ ìë™ìœ¼ë¡œ ëª¨ë“  ì ‘ê·¼ì´ ì°¨ë‹¨**ë©ë‹ˆë‹¤.
ë°˜ë“œì‹œ ì•„ë˜ì˜ í”„ë¡œë•ì…˜ìš© ë³´ì•ˆ ê·œì¹™ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

## ğŸ“‹ ë³´ì•ˆ ê·œì¹™ ì„¤ì • ë°©ë²•

### 1ë‹¨ê³„: Firebase Console ì ‘ì†
1. [Firebase Console](https://console.firebase.google.com/) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì™¼ìª½ ë©”ë‰´ â†’ **Firestore Database** í´ë¦­
4. **ê·œì¹™(Rules)** íƒ­ ì„ íƒ

### 2ë‹¨ê³„: ë³´ì•ˆ ê·œì¹™ ì½”ë“œ ë³µì‚¬

ì•„ë˜ì˜ ë³´ì•ˆ ê·œì¹™ ì½”ë“œë¥¼ ì „ì²´ ë³µì‚¬í•˜ì„¸ìš”:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ========================================
    // users ì»¬ë ‰ì…˜ ë³´ì•ˆ ê·œì¹™
    // ========================================
    match /users/{userId} {

      // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë¬¸ì„œë¥¼ ì½ì„ ìˆ˜ ìˆìŒ
      allow read: if request.auth != null && request.auth.uid == userId;

      // íšŒì›ê°€ì… ì‹œ ìì‹ ì˜ ë¬¸ì„œ ìƒì„± ê°€ëŠ¥
      // - approvedëŠ” ë°˜ë“œì‹œ falseì—¬ì•¼ í•¨ (ê´€ë¦¬ì ìŠ¹ì¸ í•„ìš”)
      // - roleì€ ë°˜ë“œì‹œ 'user'ì—¬ì•¼ í•¨ (ê´€ë¦¬ìëŠ” ìˆ˜ë™ ì„¤ì •)
      allow create: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.data.approved == false
                    && request.resource.data.role == 'user';

      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
      function isAdmin() {
        return request.auth != null
               && exists(/databases/$(database)/documents/users/$(request.auth.uid))
               && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      }

      // ê´€ë¦¬ìëŠ” ëª¨ë“  ì‚¬ìš©ì ë¬¸ì„œë¥¼ ì½ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŒ
      allow read, update: if isAdmin();

      // ì‚¬ìš©ì ì‚­ì œëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥
      allow delete: if isAdmin();
    }

    // ========================================
    // ë‹¤ë¥¸ ì»¬ë ‰ì…˜ ê·œì¹™ (í•„ìš”ì‹œ ì¶”ê°€)
    // ========================================
    // ì˜ˆ: ì—…ë¬´ì¼ì§€, í”„ë¡œê·¸ë¨ ë¡œê·¸ ë“±
    // match /workLogs/{docId} {
    //   allow read, write: if request.auth != null
    //                      && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.approved == true;
    // }
  }
}
```

### 3ë‹¨ê³„: ê·œì¹™ ì ìš©
1. Firebase Consoleì˜ ê·œì¹™ í¸ì§‘ê¸°ì— ìœ„ ì½”ë“œë¥¼ **ì „ì²´ ë¶™ì—¬ë„£ê¸°**
2. ê¸°ì¡´ ì½”ë“œë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  ìƒˆ ì½”ë“œë¡œ êµì²´
3. **ê²Œì‹œ(Publish)** ë²„íŠ¼ í´ë¦­
4. í™•ì¸ ëŒ€í™”ìƒìì—ì„œ **ê²Œì‹œ** í´ë¦­

## ğŸ”’ ë³´ì•ˆ ê·œì¹™ ì„¤ëª…

### users ì»¬ë ‰ì…˜ ê·œì¹™

| ì‘ì—… | ê¶Œí•œ | ì„¤ëª… |
|------|------|------|
| **ì½ê¸° (ë³¸ì¸)** | ë¡œê·¸ì¸í•œ ë³¸ì¸ë§Œ | ìì‹ ì˜ ì‚¬ìš©ì ì •ë³´ë§Œ ì¡°íšŒ ê°€ëŠ¥ |
| **ìƒì„± (íšŒì›ê°€ì…)** | ëˆ„êµ¬ë‚˜ | `approved=false`, `role=user`ë¡œë§Œ ìƒì„± ê°€ëŠ¥ |
| **ì½ê¸°/ìˆ˜ì • (ê´€ë¦¬ì)** | ê´€ë¦¬ìë§Œ | ëª¨ë“  ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ë° ìˆ˜ì • ê°€ëŠ¥ |
| **ì‚­ì œ** | ê´€ë¦¬ìë§Œ | ì‚¬ìš©ì ì‚­ì œëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥ |

### ì£¼ìš” ë³´ì•ˆ í¬ì¸íŠ¸

âœ… **ìë™ ìŠ¹ì¸ ë°©ì§€**: íšŒì›ê°€ì… ì‹œ `approved`ë¥¼ `true`ë¡œ ì„¤ì •í•  ìˆ˜ ì—†ìŒ
âœ… **ê¶Œí•œ ìƒìŠ¹ ë°©ì§€**: íšŒì›ê°€ì… ì‹œ `role`ì„ `admin`ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ì—†ìŒ
âœ… **ê°œì¸ì •ë³´ ë³´í˜¸**: ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì •ë³´ë§Œ ë³¼ ìˆ˜ ìˆìŒ
âœ… **ê´€ë¦¬ì ê²€ì¦**: ê´€ë¦¬ì ê¶Œí•œì€ Firestoreì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²€ì¦ë¨

## ğŸ§ª ë³´ì•ˆ ê·œì¹™ í…ŒìŠ¤íŠ¸

### Firebase Consoleì—ì„œ í…ŒìŠ¤íŠ¸

1. Firestore Database â†’ **ê·œì¹™** íƒ­
2. **ê·œì¹™ ì‹œë®¬ë ˆì´í„°** ì—´ê¸°
3. ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í…ŒìŠ¤íŠ¸:

#### í…ŒìŠ¤íŠ¸ 1: íšŒì›ê°€ì… (ì„±ê³µí•´ì•¼ í•¨)
```
ì‘ì—…: create
ìœ„ì¹˜: /users/testUserId123
ì¸ì¦: Authenticated (UID: testUserId123)
ë°ì´í„°:
{
  "uid": "testUserId123",
  "email": "test@example.com",
  "displayName": "í…ŒìŠ¤í„°",
  "approved": false,
  "role": "user"
}
```

#### í…ŒìŠ¤íŠ¸ 2: ê¶Œí•œ ìƒìŠ¹ ì‹œë„ (ì‹¤íŒ¨í•´ì•¼ í•¨)
```
ì‘ì—…: create
ìœ„ì¹˜: /users/hackerUserId
ì¸ì¦: Authenticated (UID: hackerUserId)
ë°ì´í„°:
{
  "uid": "hackerUserId",
  "email": "hacker@example.com",
  "approved": true,    // â† ì‹¤íŒ¨ ì›ì¸
  "role": "admin"      // â† ì‹¤íŒ¨ ì›ì¸
}
```

#### í…ŒìŠ¤íŠ¸ 3: ë‹¤ë¥¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ì‹¤íŒ¨í•´ì•¼ í•¨)
```
ì‘ì—…: get
ìœ„ì¹˜: /users/otherUserId
ì¸ì¦: Authenticated (UID: myUserId)
```

## âš™ï¸ ì²« ê´€ë¦¬ì ê³„ì • ì„¤ì •

ë³´ì•ˆ ê·œì¹™ì„ ì ìš©í•œ í›„, ì²« ë²ˆì§¸ ê´€ë¦¬ìëŠ” ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

### ë°©ë²• 1: Firebase Consoleì—ì„œ ì§ì ‘ ìˆ˜ì •

1. Firestore Database â†’ **ë°ì´í„°** íƒ­
2. `users` ì»¬ë ‰ì…˜ â†’ ì²« ë²ˆì§¸ ì‚¬ìš©ì ë¬¸ì„œ í´ë¦­
3. í•„ë“œ ìˆ˜ì •:
   ```
   approved: true
   role: admin
   ```
4. ì €ì¥

### ë°©ë²• 2: Firebase CLI ì‚¬ìš© (ì„ íƒì‚¬í•­)

```bash
# Firebase CLI ì„¤ì¹˜
npm install -g firebase-tools

# ë¡œê·¸ì¸
firebase login

# Firestoreì— ì§ì ‘ ë°ì´í„° ì“°ê¸°
firebase firestore:write users/USER_ID_HERE '{"approved": true, "role": "admin"}'
```

## ğŸ” ë¬¸ì œ í•´ê²°

### "ê¶Œí•œ ê±°ë¶€" ì˜¤ë¥˜ ë°œìƒ ì‹œ

1. **ë³´ì•ˆ ê·œì¹™ í™•ì¸**: ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ê²Œì‹œë˜ì—ˆëŠ”ì§€ í™•ì¸
2. **ì¸ì¦ ìƒíƒœ í™•ì¸**: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. **ìŠ¹ì¸ ìƒíƒœ í™•ì¸**: `approved` í•„ë“œê°€ `true`ì¸ì§€ í™•ì¸
4. **ìºì‹œ ì‚­ì œ**: ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸

### ê·œì¹™ ë³€ê²½ì´ ì ìš©ë˜ì§€ ì•Šì„ ë•Œ

- Firebase Consoleì—ì„œ **ê²Œì‹œ** ë²„íŠ¼ì„ ëˆŒë €ëŠ”ì§€ í™•ì¸
- ê·œì¹™ ë³€ê²½ì€ ì¦‰ì‹œ ì ìš©ë˜ì§€ë§Œ, ìºì‹œë¡œ ì¸í•´ ìµœëŒ€ 1ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆìŒ
- ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì‹œí¬ë¦¿ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸

## ğŸ“š ì¶”ê°€ ë³´ì•ˆ ê¶Œì¥ì‚¬í•­

### 1. Firebase Authentication ë„ë©”ì¸ ì œí•œ
- Firebase Console â†’ Authentication â†’ Settings
- **ìŠ¹ì¸ëœ ë„ë©”ì¸**ì— `your-domain.github.io`ë§Œ ì¶”ê°€
- ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œì˜ ì¸ì¦ ì‹œë„ ì°¨ë‹¨

### 2. API í‚¤ ì œí•œ (ì„ íƒì‚¬í•­)
- Google Cloud Console â†’ API ë° ì„œë¹„ìŠ¤ â†’ ì‚¬ìš©ì ì¸ì¦ ì •ë³´
- Firebase Web API Key í´ë¦­
- **ì• í”Œë¦¬ì¼€ì´ì…˜ ì œí•œì‚¬í•­** â†’ HTTP ë¦¬í¼ëŸ¬ ì„ íƒ
- `https://your-domain.github.io/*` ì¶”ê°€

### 3. ì •ê¸°ì ì¸ ë³´ì•ˆ ê°ì‚¬
- Firebase Console â†’ Firestore Database â†’ ê·œì¹™
- **ê·œì¹™ ì‹œë®¬ë ˆì´í„°**ë¡œ ì •ê¸°ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
- ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì ‘ê·¼ ì‹œë„ëŠ” Firebase Analyticsì—ì„œ ëª¨ë‹ˆí„°ë§

## â±ï¸ í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë§Œë£Œ ëŒ€ë¹„

í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹œì‘í•œ ê²½ìš°:
- **ë§Œë£Œì¼**: ìµœì´ˆ ì„¤ì • í›„ 30ì¼
- **ë§Œë£Œ í›„**: ëª¨ë“  ì½ê¸°/ì“°ê¸° ì‘ì—…ì´ ì°¨ë‹¨ë¨
- **í•´ê²° ë°©ë²•**: ìœ„ì˜ í”„ë¡œë•ì…˜ ê·œì¹™ì„ ì¦‰ì‹œ ì ìš©

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ë°œìƒí•˜ë©´:
1. Firebase Console â†’ ì§€ì› â†’ ë¬¸ì„œ í™•ì¸
2. [Firebase ê³µì‹ ë¬¸ì„œ](https://firebase.google.com/docs/firestore/security/get-started)
3. [Stack Overflow](https://stackoverflow.com/questions/tagged/google-cloud-firestore)

---

**ì¤‘ìš”**: ì´ ë³´ì•ˆ ê·œì¹™ì€ ìš´ì˜ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
ê·œì¹™ì„ ìˆ˜ì •í•  ë•ŒëŠ” í•­ìƒ **ê·œì¹™ ì‹œë®¬ë ˆì´í„°**ë¡œ í…ŒìŠ¤íŠ¸í•œ í›„ ì ìš©í•˜ì„¸ìš”.
