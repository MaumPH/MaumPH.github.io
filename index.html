<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주간보호센터 업무수행도우미</title>
    <meta name="description" content="주간보호센터 프로그램 관리자를 위한 AI 기반 업무 문서 자동 작성 시스템">
    <meta property="og:title" content="주간보호센터 업무수행도우미">
    <meta property="og:description" content="업무수행일지, 프로그램 일지, 사례관리, 상담일지를 AI로 자동 생성">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://maumph.github.io/">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "primary-dark": "#106cc9",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "surface-light": "#ffffff",
                        "surface-dark": "#1a2632",
                    },
                    fontFamily: {
                        "display": ["Inter", "Noto Sans KR", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .icon-fill {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .page-hidden { display: none; }
        .page-active { display: block; }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #137fec;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .drag-over {
            border-color: #137fec !important;
            background-color: rgba(19, 127, 236, 0.05) !important;
        }
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        #loading-overlay.active {
            display: flex;
        }
        .loading-content {
            background: white;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        .loading-spinner-large {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #137fec;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark min-h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-white dark:bg-surface-dark border-r border-gray-200 dark:border-gray-700 flex flex-col shrink-0 h-screen fixed left-0 top-0 z-20">
        <div class="flex flex-col gap-6 p-6 flex-1">
            <div class="flex flex-col gap-1">
                <h1 class="text-gray-900 dark:text-white text-xl font-bold tracking-tight">업무수행도우미</h1>
                <p class="text-gray-500 dark:text-gray-400 text-xs font-normal">주간보호센터</p>
            </div>
            <nav class="flex flex-col gap-1">
                <!-- 일지 관리 메뉴 (확장형) -->
                <div class="flex flex-col">
                    <button id="journal-menu-toggle" class="flex items-center justify-between w-full px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-sm transition-colors" onclick="toggleJournalMenu()">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-gray-500">description</span>
                            <span>일지 관리</span>
                        </div>
                        <span id="journal-menu-icon" class="material-symbols-outlined text-lg">expand_less</span>
                    </button>
                    <div id="journal-submenu" class="flex flex-col gap-0.5 mt-1 pl-3">
                        <a href="#" id="nav-step1" onclick="showPage('step1'); return false;" class="submenu-link relative pl-8 pr-3 py-2.5 rounded-md text-sm text-gray-600 dark:text-gray-400 hover:text-primary hover:bg-primary/5 dark:hover:text-primary transition-colors flex items-center gap-2">
                            <div class="absolute left-3.5 top-0 bottom-0 w-px bg-gray-200 dark:bg-gray-600"></div>
                            <div class="absolute left-2.5 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600 submenu-dot"></div>
                            어르신의 심신상태
                        </a>
                        <a href="#" id="nav-step2" onclick="showPage('step2'); return false;" class="submenu-link relative pl-8 pr-3 py-2.5 rounded-md text-sm text-gray-600 dark:text-gray-400 hover:text-primary hover:bg-primary/5 dark:hover:text-primary transition-colors flex items-center gap-2">
                            <div class="absolute left-3.5 top-0 bottom-0 w-px bg-gray-200 dark:bg-gray-600"></div>
                            <div class="absolute left-2.5 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600 submenu-dot"></div>
                            프로그램 제공계획
                        </a>
                        <a href="#" id="nav-step3" onclick="showPage('step3'); return false;" class="submenu-link relative pl-8 pr-3 py-2.5 rounded-md text-sm text-gray-600 dark:text-gray-400 hover:text-primary hover:bg-primary/5 dark:hover:text-primary transition-colors flex items-center gap-2">
                            <div class="absolute left-3.5 top-0 bottom-0 w-px bg-gray-200 dark:bg-gray-600"></div>
                            <div class="absolute left-2.5 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600 submenu-dot"></div>
                            향후계획 및 기타사항
                        </a>
                    </div>
                </div>

                <a class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group" href="#" id="nav-program-log" onclick="showPage('program-log'); return false;">
                    <span class="material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors">calendar_today</span>
                    <p class="text-gray-500 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white text-sm font-medium">프로그램 제공일지</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group" href="#" id="nav-case-management" onclick="showPage('case-management'); return false;">
                    <span class="material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors">assignment</span>
                    <p class="text-gray-500 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white text-sm font-medium">사례관리 작성</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group" href="#" id="nav-counseling-log" onclick="showPage('counseling-log'); return false;">
                    <span class="material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors">chat</span>
                    <p class="text-gray-500 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white text-sm font-medium">상담일지 작성</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group" href="#" id="nav-newsletter" onclick="showPage('newsletter'); return false;">
                    <span class="material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors">newspaper</span>
                    <p class="text-gray-500 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white text-sm font-medium">소식지 만들기</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group" href="#" id="nav-vehicle-checker" onclick="showPage('vehicle-checker'); return false;">
                    <span class="material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors">directions_car</span>
                    <p class="text-gray-500 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white text-sm font-medium">차량중복확인</p>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group" href="#" id="nav-settings" onclick="showPage('settings'); return false;">
                    <span class="material-symbols-outlined text-gray-500 group-hover:text-primary transition-colors">settings</span>
                    <p class="text-gray-500 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white text-sm font-medium">설정</p>
                </a>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 ml-64 flex flex-col h-screen overflow-y-auto">
        <div id="main-content" class="flex-1 p-8 md:p-12">
            <div class="max-w-6xl mx-auto flex flex-col gap-6">

                <!-- Progress Bar (일지 작성 페이지에만 표시) -->
                <div id="progress-section" class="flex flex-col gap-2">
                    <div class="flex justify-between items-end">
                        <p id="step-indicator" class="text-primary font-bold text-sm tracking-wide uppercase">STEP 1 OF 3</p>
                        <p id="progress-text" class="text-gray-500 text-sm font-medium">0% 완료</p>
                    </div>
                    <div class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div id="progress-bar" class="h-full bg-primary transition-all duration-500 ease-out" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Step 1: PDF Upload & 심신상태 -->
                <div id="page-step1" class="page-active">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-gray-900 dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-tight">
                            욕구사정 PDF 업로드 및 심신상태 작성
                        </h1>
                        <p class="text-gray-500 dark:text-gray-300 text-lg font-normal leading-relaxed">
                            욕구사정 평가지 PDF를 업로드하면 심신상태 및 환경변화 항목이 자동으로 작성됩니다.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                        <!-- PDF Upload Section -->
                        <div class="lg:col-span-4">
                            <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                                <h3 class="text-base font-bold text-gray-900 dark:text-white flex items-center gap-2 mb-4">
                                    <span class="material-symbols-outlined text-red-500">picture_as_pdf</span>
                                    욕구사정 PDF 업로드
                                </h3>

                                <div id="pdf-upload-area" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-primary hover:bg-gray-50 dark:hover:bg-gray-800 transition-all" onclick="document.getElementById('pdf-file-input').click()">
                                    <input type="file" id="pdf-file-input" accept=".pdf" class="hidden" onchange="handlePDFUpload(event)">
                                    <span class="material-symbols-outlined text-4xl text-gray-400 mb-3 block">upload_file</span>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">PDF 파일을 선택하거나 여기로 드래그하세요</p>
                                    <button class="mt-3 px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-dark transition-colors">
                                        파일 선택
                                    </button>
                                </div>

                                <div id="pdf-preview" class="hidden mt-4">
                                    <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                        <span class="material-symbols-outlined text-green-600 icon-fill">check_circle</span>
                                        <div class="flex-1 min-w-0">
                                            <p id="pdf-filename" class="text-sm font-medium text-gray-900 dark:text-white truncate"></p>
                                            <p class="text-xs text-gray-500">PDF 업로드 완료</p>
                                        </div>
                                    </div>
                                    <button onclick="analyzePDF()" id="analyze-btn" class="w-full mt-4 px-4 py-3 bg-primary text-white rounded-lg font-bold hover:bg-primary-dark transition-colors flex items-center justify-center gap-2">
                                        <span class="material-symbols-outlined">auto_awesome</span>
                                        PDF 분석 시작
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 심신상태 Form -->
                        <div class="lg:col-span-8">
                            <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900 flex justify-between items-center">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                        <span class="material-symbols-outlined text-primary">auto_awesome</span>
                                        심신상태 및 환경변화 (자동분석)
                                    </h3>
                                    <button onclick="regenerateFields()" class="text-xs text-primary font-medium hover:underline flex items-center gap-1">
                                        <span class="material-symbols-outlined text-sm">refresh</span>
                                        데이터 다시 불러오기
                                    </button>
                                </div>

                                <div class="p-6">
                                    <div id="analysis-status" class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                        <p class="text-sm text-blue-800 dark:text-blue-200 flex items-center gap-2">
                                            <span class="material-symbols-outlined text-lg">info</span>
                                            PDF를 업로드하고 분석 버튼을 클릭하면 항목이 자동으로 채워집니다.
                                        </p>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">1. 식사 및 영양상태</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-1" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">2. 보행</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-2" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">3. 신체기능</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-3" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">4. 배뇨·배변기능</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-4" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">5. 위생관리</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-5" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">6. 일상생활수행</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-6" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">7. 인지기능</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-7" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">8. 행동증상</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-8" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">9. 가족 및 생활환경</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-9" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="text-sm font-semibold text-gray-900 dark:text-gray-300">10. 기타 및 종합의견</label>
                                            <div class="flex gap-2">
                                                <textarea id="field-10" class="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-primary focus:border-primary resize-none min-h-[80px]" placeholder="100자 내외로 자동 작성됩니다"></textarea>
                                                <span class="material-symbols-outlined text-green-500 text-lg self-center hidden verified-icon">check_circle</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between pt-6 mt-6 border-t border-gray-200 dark:border-gray-700">
                        <button class="px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                            임시 저장
                        </button>
                        <button onclick="showPage('step2')" id="step1-next" class="px-8 py-3 rounded-lg bg-primary text-white font-bold hover:bg-primary-dark shadow-md transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            다음 단계
                            <span class="material-symbols-outlined text-xl">arrow_forward</span>
                        </button>
                    </div>
                </div>

                <!-- Step 2: 프로그램 제공계획 -->
                <div id="page-step2" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-gray-900 dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-tight">
                            프로그램 제공계획 및 제공내용
                        </h1>
                        <p class="text-gray-500 dark:text-gray-300 text-lg font-normal leading-relaxed">
                            금일 제공된 프로그램 내용과 어르신의 참여도, 계획 이행 여부를 기록합니다.
                        </p>
                    </div>

                    <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <label class="text-base font-bold text-gray-900 dark:text-white mb-2 flex items-center justify-between">
                            프로그램 수행 내용
                            <span class="text-xs font-normal text-gray-500">내용 입력 후 생성을 눌러주세요</span>
                        </label>
                        <div class="mb-3 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800">
                            <p class="text-sm text-gray-600 dark:text-gray-400 flex items-start gap-2">
                                <span class="material-symbols-outlined text-lg text-primary mt-0.5 shrink-0">info</span>
                                작성 지침: 날짜, 프로그램명, 주요 활동 내용을 포함하여 자유롭게 입력하면 상세 내용이 자동 완성됩니다.
                            </p>
                        </div>
                        <textarea id="user-input" class="w-full min-h-[120px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-4 text-base leading-relaxed placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="예: 2025.09.16 / 외부강사프로그램(여가인지) 버섯블럭을 이용해서 동물모양을 잘 만들어서 표현하심"></textarea>
                        <button onclick="generateProgramContent()" class="w-full mt-4 bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-all">
                            <span class="material-symbols-outlined text-xl">auto_awesome</span>
                            내용 기반 상세 항목 생성
                        </button>
                    </div>

                    <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                        <div class="flex items-center gap-2 mb-6 border-b border-gray-200 dark:border-gray-700 pb-4">
                            <span class="material-symbols-outlined text-primary">description</span>
                            <h3 class="text-lg font-bold text-gray-900 dark:text-white">상세 제공 기록</h3>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-bold text-gray-900 dark:text-white">필요내용</label>
                                <textarea id="program-need" class="w-full h-[140px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-sm text-gray-900 dark:text-white p-3 leading-relaxed focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-bold text-gray-900 dark:text-white">제공방법</label>
                                <textarea id="program-method" class="w-full h-[140px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-sm text-gray-900 dark:text-white p-3 leading-relaxed focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-6">
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-bold text-gray-900 dark:text-white">어르신 반응 및 특이사항</label>
                                <textarea id="program-reaction" class="w-full h-[160px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-sm text-gray-900 dark:text-white p-3 leading-relaxed focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-bold text-gray-900 dark:text-white">요양쌤 모니터링</label>
                                <textarea id="program-monitoring" class="w-full h-[160px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-sm text-gray-900 dark:text-white p-3 leading-relaxed focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between pt-6 mt-6 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="showPage('step1')" class="px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-surface-dark text-gray-900 dark:text-white font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2">
                            <span class="material-symbols-outlined text-xl">arrow_back</span>
                            이전 단계
                        </button>
                        <div class="flex gap-3">
                            <button class="px-6 py-3 rounded-lg text-primary font-medium hover:bg-primary/5 transition-colors">
                                임시 저장
                            </button>
                            <button onclick="showPage('step3')" id="step2-next" class="px-8 py-3 rounded-lg bg-primary text-white font-bold hover:bg-primary-dark shadow-md transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                다음 단계
                                <span class="material-symbols-outlined text-xl">arrow_forward</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: 향후계획 -->
                <div id="page-step3" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-gray-900 dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-tight">
                            향후계획 및 기타사항
                        </h1>
                        <p class="text-gray-500 dark:text-gray-300 text-lg font-normal leading-relaxed">
                            금일 관찰된 어르신의 상태 및 욕구를 종합하고, 이를 반영한 향후 급여 제공 계획을 기록합니다.
                        </p>
                    </div>

                    <div class="bg-gradient-to-r from-primary/5 to-primary/10 dark:from-primary/10 dark:to-primary/20 border border-primary/20 rounded-xl p-6 flex flex-col md:flex-row items-center justify-between gap-4 mb-6">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 rounded-full bg-white dark:bg-surface-dark flex items-center justify-center shrink-0 shadow-sm text-primary">
                                <span class="material-symbols-outlined text-2xl">auto_awesome</span>
                            </div>
                            <div class="flex flex-col">
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">내용 자동 생성</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    '심신상태' 및 '프로그램 제공내용'에 입력된 데이터를 분석하여 아래 항목들을 자동으로 작성합니다.
                                </p>
                            </div>
                        </div>
                        <button onclick="generateFuturePlan()" class="shrink-0 px-6 py-3 bg-primary hover:bg-primary-dark text-white font-bold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2 w-full md:w-auto justify-center">
                            <span class="material-symbols-outlined">refresh</span>
                            내용 생성하기
                        </button>
                    </div>

                    <div class="grid grid-cols-1 gap-6">
                        <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="material-symbols-outlined text-primary">summarize</span>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">종합</h3>
                            </div>
                            <div class="flex flex-col gap-2">
                                <div class="mb-2 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border border-gray-100 dark:border-gray-700">
                                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed flex items-start gap-2">
                                        <span class="material-symbols-outlined text-base mt-0.5 shrink-0 text-primary">info</span>
                                        심신상태 변화와 프로그램 참여도를 바탕으로 금일 수급자의 전반적인 상태를 종합적으로 요약하여 기록합니다.
                                    </p>
                                </div>
                                <textarea id="future-summary" class="w-full min-h-[160px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-4 text-base leading-relaxed placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="material-symbols-outlined text-primary">gpp_maybe</span>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">급여제공 관련 유의사항</h3>
                            </div>
                            <div class="flex flex-col gap-2">
                                <div class="mb-2 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border border-gray-100 dark:border-gray-700">
                                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed flex items-start gap-2">
                                        <span class="material-symbols-outlined text-base mt-0.5 shrink-0 text-primary">info</span>
                                        낙상 위험, 식사 시 연하 곤란 등 수급자의 안전과 건강을 위해 급여 제공 시 특별히 유의해야 할 사항을 기재합니다.
                                    </p>
                                </div>
                                <textarea id="future-caution" class="w-full min-h-[160px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-4 text-base leading-relaxed placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="material-symbols-outlined text-primary">edit_calendar</span>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">급여제공 관련 세부계획</h3>
                            </div>
                            <div class="flex flex-col gap-2">
                                <div class="mb-2 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border border-gray-100 dark:border-gray-700">
                                    <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed flex items-start gap-2">
                                        <span class="material-symbols-outlined text-base mt-0.5 shrink-0 text-primary">info</span>
                                        확인된 욕구 및 유의사항을 반영하여 차주 또는 향후 제공할 구체적인 서비스 계획을 작성합니다.
                                    </p>
                                </div>
                                <textarea id="future-plan" class="w-full min-h-[160px] resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-4 text-base leading-relaxed placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="자동 생성됩니다"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between pt-6 mt-6 border-t border-gray-200 dark:border-gray-700 mb-8">
                        <button onclick="showPage('step2')" class="px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-surface-dark text-gray-900 dark:text-white font-medium hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2">
                            <span class="material-symbols-outlined text-xl">arrow_back</span>
                            이전 단계
                        </button>
                        <div class="flex gap-3">
                            <button class="px-6 py-3 rounded-lg text-primary font-medium hover:bg-primary/5 transition-colors">
                                임시 저장
                            </button>
                            <button onclick="completeJournal()" class="px-8 py-3 rounded-lg bg-primary text-white font-bold hover:bg-primary-dark shadow-md transition-all flex items-center gap-2 active:scale-95">
                                <span class="material-symbols-outlined text-xl">check_circle</span>
                                작성 완료
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Case Management Page -->
                <div id="page-case-management" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight">사례관리 작성</h1>
                        <p class="text-gray-500 dark:text-gray-400 mt-1">수급자의 변화와 회의 내용을 입력하여 평가 기준을 충족하는 사례관리 회의록을 생성합니다.</p>
                    </div>

                    <!-- 기본 정보 입력 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">person</span>
                            수급자 기본 정보
                            <span class="text-xs text-red-500 font-medium">(필수)</span>
                        </h3>

                        <div class="grid grid-cols-1 gap-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-medium text-gray-900 dark:text-white">수급자명</label>
                                    <input type="text" id="cm-recipient-name" placeholder="예: 김OO" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-medium text-gray-900 dark:text-white">나이</label>
                                    <input type="number" id="cm-age" placeholder="예: 78" min="1" max="120" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-medium text-gray-900 dark:text-white">진단명</label>
                                    <input type="text" id="cm-diagnosis" placeholder="예: 치매, 고혈압" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                                </div>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">최근 변화</label>
                                <textarea id="cm-recent-changes" rows="3" placeholder="예: 오후 시간대 자리 이동과 주변을 반복하여 확인하는 행동이 증가하고, 프로그램 중 집중 저하와 짧은 피로 호소가 나타남" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-3 focus:ring-2 focus:ring-primary"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 회의 정보 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">groups</span>
                            회의 정보
                            <span class="text-xs text-red-500 font-medium">(필수)</span>
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">회의 연도</label>
                                <input type="number" id="cm-year" placeholder="예: 2025" min="2020" max="2099" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">분기</label>
                                <select id="cm-quarter" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary">
                                    <option value="1">1분기</option>
                                    <option value="2">2분기</option>
                                    <option value="3">3분기</option>
                                    <option value="4">4분기</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium text-gray-900 dark:text-white">회의 참석자 (3명 이상, 직종별 1명 이상 포함)</label>
                            <input type="text" id="cm-attendees" placeholder="예: 김철수 센터장, 박영희 사회복지사, 이순자 요양보호사, 최민지 요양보호사, 정수연 간호조무사" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                            <p class="text-xs text-gray-500">쉼표로 구분하여 입력하세요. 입력한 그대로 회의록에 표시됩니다.</p>
                        </div>
                    </div>

                    <!-- 추가 정보 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">description</span>
                            추가 정보
                            <span class="text-xs text-gray-500 font-medium">(선택사항)</span>
                        </h3>

                        <div class="grid grid-cols-1 gap-4">
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">보호자 정보</label>
                                <textarea id="cm-guardian-info" rows="2" placeholder="예: 딸과 거주, 주 3회 전화 상담" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-3 focus:ring-2 focus:ring-primary"></textarea>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">프로그램 참여도</label>
                                <textarea id="cm-program-participation" rows="2" placeholder="예: 미술 프로그램 적극 참여, 오후 활동 시 집중력 저하" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-3 focus:ring-2 focus:ring-primary"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 급여반영 정보 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">published_with_changes</span>
                            급여제공 반영 정보
                            <span class="text-xs text-red-500 font-medium">(필수)</span>
                        </h3>

                        <div class="grid grid-cols-1 gap-4">
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">급여구분</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-2 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="신체활동지원" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">신체활동지원</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="인지활동지원" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">인지활동지원</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="인지관리지원" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">인지관리지원</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="정서지원" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">정서지원</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="개인활동지원" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">개인활동지원</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="지역사회연계" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">지역사회연계</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="건강관리" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">건강관리</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="간호처치" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">간호처치</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="기능회복훈련" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">기능회복훈련</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="응급지원" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">응급지원</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" class="cm-service-checkbox" value="생활 및 환경관리" class="w-4 h-4"/>
                                        <span class="text-sm text-gray-900 dark:text-white">생활 및 환경관리</span>
                                    </label>
                                </div>
                                <div id="cm-selected-services" class="text-sm text-gray-700 dark:text-gray-300 p-2 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800 hidden">
                                    <span class="font-semibold">선택된 급여구분:</span> <span id="cm-selected-services-text"></span>
                                </div>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">급여내용</label>
                                <textarea id="cm-service-content" rows="3" placeholder="예: 관찰 강화 및 인지지원 프로그램 제공" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-3 focus:ring-2 focus:ring-primary"></textarea>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">반영사유</label>
                                <textarea id="cm-reflection-reason" rows="2" placeholder="예: 오후 불안정 행동 대응 및 정서적 안정 필요" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-3 focus:ring-2 focus:ring-primary"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 생성 버튼 -->
                    <div class="flex justify-center mb-6">
                        <button onclick="generateCaseManagement()" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-semibold text-base shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">auto_awesome</span>
                            AI로 사례관리 회의록 생성하기
                        </button>
                    </div>

                    <!-- 결과 출력 -->
                    <div id="cm-result-section" class="hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-base font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary">article</span>
                                    생성된 사례관리 회의록
                                </h3>
                                <button onclick="copyCaseManagementResult()" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium flex items-center gap-2 transition-colors">
                                    <span class="material-symbols-outlined text-lg">content_copy</span>
                                    전체 복사
                                </button>
                            </div>

                            <div id="cm-result-content" class="space-y-6">
                                <!-- 결과가 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Counseling Log Page -->
                <div id="page-counseling-log" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight">상담일지 작성</h1>
                        <p class="text-gray-500 dark:text-gray-400 mt-1">보호자와의 상담 내용을 입력하면 AI가 자동으로 상담일지를 작성합니다.</p>
                    </div>

                    <!-- 상담 정보 입력 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">info</span>
                            기본 정보
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">상담 날짜</label>
                                <input type="date" id="cl-date" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">상담 방식</label>
                                <select id="cl-method" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                                    <option value="유선" selected>유선</option>
                                    <option value="대면">대면</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">어르신 성함</label>
                                <input type="text" id="cl-elder-name" placeholder="예: 홍길동" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">보호자 관계</label>
                                <input type="text" id="cl-guardian-relation" placeholder="예: 딸, 아들, 며느리" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                            </div>
                            <div class="md:col-span-2">
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">작성 방식</label>
                                <select id="cl-writing-style" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                                    <option value="mixed" selected>대화체</option>
                                    <option value="report">보고체</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 상담 내용 입력 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">edit_note</span>
                            상담 내용
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">보호자 요청 또는 문의내용 (선택)</label>
                                <textarea id="cl-guardian-request" rows="3" placeholder="예: 어르신이 집에서 자꾸 넘어지시는데 센터에서는 어떠신지 궁금합니다..." class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary"></textarea>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">센터 요청 또는 문의내용 (선택)</label>
                                <textarea id="cl-center-request" rows="3" placeholder="예: 어르신 외출 시 주의사항 전달..." class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 생성 버튼 -->
                    <div class="flex justify-center mb-6">
                        <button onclick="generateCounselingLog()" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-semibold text-base shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">auto_awesome</span>
                            AI로 상담일지 생성하기
                        </button>
                    </div>

                    <!-- 결과 출력 -->
                    <div id="cl-result-section" class="hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-base font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary">description</span>
                                    생성된 상담일지
                                </h3>
                                <button onclick="copyCounselingLogResult()" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium flex items-center gap-2 transition-colors">
                                    <span class="material-symbols-outlined text-lg">content_copy</span>
                                    전체 복사
                                </button>
                            </div>

                            <div id="cl-result-content" class="space-y-4 text-sm text-gray-900 dark:text-white leading-relaxed bg-gray-50 dark:bg-gray-900 p-6 rounded-lg">
                                <!-- 결과가 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Newsletter Page -->
                <div id="page-newsletter" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight">소식지 만들기</h1>
                        <p class="text-gray-500 dark:text-gray-400 mt-1">활동 이미지를 업로드하고 AI가 자동으로 제목과 소식지 내용을 생성합니다.</p>
                    </div>

                    <!-- 이미지 업로드 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">image</span>
                            활동 이미지 업로드 (3개)
                        </h3>

                        <!-- 드래그 앤 드롭 영역 -->
                        <div id="nl-drop-zone" class="mb-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center bg-gray-50 dark:bg-gray-800 hover:border-primary hover:bg-gray-100 dark:hover:bg-gray-700 transition-all cursor-pointer">
                            <div class="flex flex-col items-center gap-3">
                                <span class="material-symbols-outlined text-5xl text-gray-400">cloud_upload</span>
                                <p class="text-gray-700 dark:text-gray-300 font-medium">이미지를 여기에 드래그하거나 클릭하세요</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">정확히 3개의 이미지를 선택해주세요 (JPG, PNG)</p>
                            </div>
                            <input type="file" id="nl-image-input" accept="image/*" multiple style="display: none;" onchange="handleNewsletterImages(this)">
                        </div>

                        <div id="newsletter-image-status" class="mb-4"></div>

                        <div id="nl-images-preview" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Image 1 -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <div class="aspect-video bg-gray-100 dark:bg-gray-700 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <img id="nl-preview-1" class="hidden w-full h-full object-cover" alt="활동 1">
                                    <span id="nl-placeholder-1" class="text-gray-400 text-sm">활동 1</span>
                                </div>
                                <label class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 block">설명 (선택)</label>
                                <input type="text" id="nl-desc-1" placeholder="예: 대추를 정성스럽게 다듬는 중" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                            </div>

                            <!-- Image 2 -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <div class="aspect-video bg-gray-100 dark:bg-gray-700 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <img id="nl-preview-2" class="hidden w-full h-full object-cover" alt="활동 2">
                                    <span id="nl-placeholder-2" class="text-gray-400 text-sm">활동 2</span>
                                </div>
                                <label class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 block">설명 (선택)</label>
                                <input type="text" id="nl-desc-2" placeholder="예: 즐겁게 놀이하는 모습" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                            </div>

                            <!-- Image 3 -->
                            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                                <div class="aspect-video bg-gray-100 dark:bg-gray-700 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <img id="nl-preview-3" class="hidden w-full h-full object-cover" alt="활동 3">
                                    <span id="nl-placeholder-3" class="text-gray-400 text-sm">활동 3</span>
                                </div>
                                <label class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2 block">설명 (선택)</label>
                                <input type="text" id="nl-desc-3" placeholder="예: 완성된 작품을 자랑스러워하심" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
                            </div>
                        </div>
                    </div>

                    <!-- 생성 버튼 -->
                    <div class="flex justify-center mb-6">
                        <button onclick="generateNewsletter()" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-semibold text-base shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">auto_awesome</span>
                            AI로 소식지 생성하기
                        </button>
                    </div>

                    <!-- 결과 출력 -->
                    <div id="nl-result-section" class="hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-base font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary">article</span>
                                    생성된 소식지
                                </h3>
                                <button onclick="copyNewsletterResult()" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium flex items-center gap-2 transition-colors">
                                    <span class="material-symbols-outlined text-lg">content_copy</span>
                                    전체 복사
                                </button>
                            </div>

                            <div id="nl-result-content" class="whitespace-pre-wrap text-sm text-gray-900 dark:text-white leading-relaxed bg-gray-50 dark:bg-gray-900 p-6 rounded-lg min-h-[400px]">
                                <!-- 결과가 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Checker Page -->
                <div id="page-vehicle-checker" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight">차량중복확인</h1>
                        <p class="text-gray-500 dark:text-gray-400 mt-1">엑셀 파일을 업로드하여 입소/퇴소 차량 시간 중복을 자동으로 확인합니다.</p>
                    </div>

                    <!-- 파일 업로드 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">upload_file</span>
                            엑셀 파일 업로드
                        </h3>

                        <div class="mb-4">
                            <button onclick="document.getElementById('vc-file-input').click()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg font-semibold text-base shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2">
                                <span class="material-symbols-outlined">description</span>
                                엑셀 파일 선택하기
                            </button>
                            <input type="file" id="vc-file-input" accept=".xlsx,.xls" style="display: none;" onchange="handleVehicleFile(this)">
                        </div>

                        <div id="vc-file-status" class="mb-4"></div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                            <h4 class="text-sm font-bold text-blue-900 dark:text-blue-200 mb-2">📋 필수 엑셀 형식</h4>
                            <ul class="text-sm text-blue-800 dark:text-blue-300 space-y-1">
                                <li>• 시트 이름: <code class="bg-blue-100 dark:bg-blue-900 px-1 rounded">Sheet1</code></li>
                                <li>• 필수 컬럼: 일자, 입퇴소구분, 성명, 생년월일, 차량(입소), 입소시간, 차량(퇴소), 퇴소시간</li>
                                <li>• 입퇴소구분 값: <code class="bg-blue-100 dark:bg-blue-900 px-1 rounded">입퇴소</code></li>
                            </ul>
                        </div>
                    </div>

                    <!-- 검사 실행 버튼 -->
                    <div class="flex justify-center mb-6">
                        <button onclick="checkVehicleOverlap()" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-semibold text-base shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">search</span>
                            중복 검사 실행
                        </button>
                    </div>

                    <!-- 결과 출력 -->
                    <div id="vc-result-section" class="hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-base font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary">assignment</span>
                                    검사 결과
                                </h3>
                                <button onclick="copyVehicleResult()" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium flex items-center gap-2 transition-colors">
                                    <span class="material-symbols-outlined text-lg">content_copy</span>
                                    결과 복사
                                </button>
                            </div>

                            <div id="vc-result-content" class="whitespace-pre-wrap text-sm text-gray-900 dark:text-white leading-relaxed bg-gray-50 dark:bg-gray-900 p-6 rounded-lg min-h-[400px] font-mono">
                                <!-- 결과가 여기에 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="page-settings" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-8">
                        <h2 class="text-gray-900 dark:text-white text-3xl font-bold tracking-tight">API 설정</h2>
                        <p class="text-gray-600 text-base">욕구사정 기반 일지 자동 작성을 위한 AI 모델 연결 정보를 설정합니다.</p>
                    </div>

                    <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 md:p-8">
                        <div class="flex flex-col gap-6">
                            <div class="flex flex-col gap-2">
                                <label class="text-gray-900 dark:text-white text-sm font-medium">사용할 AI 모델</label>
                                <div class="relative">
                                    <div class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 h-12 px-4 flex items-center select-none">
                                        Gemini 3.0 Flash Preview (최신, 가장 강력)
                                    </div>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                        <span class="material-symbols-outlined text-[20px]">lock</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">업무 일지 생성의 정확도와 속도에 영향을 줍니다.</p>
                            </div>

                            <hr class="border-t border-gray-200 dark:border-gray-700 my-2"/>

                            <div class="flex flex-col gap-2">
                                <label class="text-gray-900 dark:text-white text-sm font-medium">Gemini API Key</label>
                                <div class="relative flex items-center group/input">
                                    <span class="absolute left-4 text-gray-500 material-symbols-outlined text-[20px]">key</span>
                                    <input id="api-key-input" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-surface-dark text-gray-900 dark:text-white h-12 pl-12 pr-12 focus:outline-none focus:ring-2 focus:ring-primary placeholder:text-gray-400" placeholder="AIza..." type="password"/>
                                    <button class="absolute right-0 top-0 bottom-0 px-3 flex items-center justify-center text-gray-500 hover:text-gray-900 dark:hover:text-white transition-colors focus:outline-none" type="button" onclick="toggleAPIKeyVisibility()">
                                        <span id="visibility-icon" class="material-symbols-outlined text-[20px]">visibility_off</span>
                                    </button>
                                </div>
                                <div class="flex justify-between items-start mt-1">
                                    <p class="text-xs text-gray-500">API 키는 브라우저 내부에 안전하게 저장되며 서버로 전송되지 않습니다.</p>
                                    <a class="text-xs text-primary hover:text-primary-dark font-medium flex items-center gap-1 group/link" href="https://aistudio.google.com/app/apikey" target="_blank">
                                        API 키 발급 방법
                                        <span class="material-symbols-outlined text-[14px] group-hover/link:translate-x-0.5 transition-transform">open_in_new</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-primary/5 dark:bg-primary/10 rounded-xl border border-primary/10 p-4 flex flex-col md:flex-row md:items-center justify-between gap-4 mt-6">
                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white dark:bg-surface-dark rounded-lg shadow-sm text-primary">
                                <span class="material-symbols-outlined">analytics</span>
                            </div>
                            <div class="flex flex-col">
                                <h4 class="text-sm font-bold text-gray-900 dark:text-white">이번 달 사용량</h4>
                                <p class="text-xs text-gray-600">현재 설정된 API 키로 생성된 일지 수</p>
                            </div>
                        </div>
                        <div class="flex items-baseline gap-1 md:pr-4">
                            <span id="usage-count" class="text-2xl font-bold text-gray-900 dark:text-white">0</span>
                            <span class="text-sm text-gray-600">건</span>
                        </div>
                    </div>

                    <div class="flex justify-between items-center pt-4">
                        <button onclick="handleLogout()" class="border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 text-base font-medium h-12 px-8 rounded-lg transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">logout</span>
                            로그아웃
                        </button>
                        <button onclick="saveAPIKey()" class="bg-primary hover:bg-primary-dark text-white text-base font-medium h-12 px-8 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">save</span>
                            설정 저장
                        </button>
                    </div>
                </div>

                <!-- Program Log Page -->
                <div id="page-program-log" class="page-hidden">
                    <div class="flex flex-col gap-2 mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white tracking-tight">프로그램 제공일지 작성</h1>
                        <p class="text-gray-500 dark:text-gray-400 mt-1">어르신들의 프로그램 반응을 AI로 생성하여 제공일지를 작성합니다.</p>
                    </div>

                    <!-- 기본 설정 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-4">기본 설정</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <!-- 생성 개수 -->
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">생성 개수</label>
                                <input type="number" id="reaction-count" value="10" min="1" max="50" step="1" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                                <p class="text-xs text-gray-500">1~50개 범위로 입력하세요</p>
                            </div>
                        </div>

                        <!-- 감정 비율 조정 -->
                        <div class="flex flex-col gap-3 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <label class="text-sm font-bold text-gray-900 dark:text-white">감정 비율 설정 (10 단위)</label>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- 긍정 -->
                                <div class="flex flex-col gap-1">
                                    <label class="text-xs text-gray-600 dark:text-gray-400">😊 긍정</label>
                                    <div class="flex items-center gap-2">
                                        <button type="button" onclick="adjustRatio('positive', -10)" class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 flex items-center justify-center">-</button>
                                        <input type="number" id="positive-ratio" min="0" max="100" step="10" value="50" class="flex-1 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 text-center focus:ring-2 focus:ring-primary" oninput="updateRatioDisplay()"/>
                                        <button type="button" onclick="adjustRatio('positive', 10)" class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 flex items-center justify-center">+</button>
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">%</span>
                                    </div>
                                </div>

                                <!-- 중립 -->
                                <div class="flex flex-col gap-1">
                                    <label class="text-xs text-gray-600 dark:text-gray-400">😐 중립</label>
                                    <div class="flex items-center gap-2">
                                        <button type="button" onclick="adjustRatio('neutral', -10)" class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 flex items-center justify-center">-</button>
                                        <input type="number" id="neutral-ratio" min="0" max="100" step="10" value="30" class="flex-1 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 text-center focus:ring-2 focus:ring-primary" oninput="updateRatioDisplay()"/>
                                        <button type="button" onclick="adjustRatio('neutral', 10)" class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 flex items-center justify-center">+</button>
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">%</span>
                                    </div>
                                </div>

                                <!-- 소극/피로 -->
                                <div class="flex flex-col gap-1">
                                    <label class="text-xs text-gray-600 dark:text-gray-400">😔 소극/피로</label>
                                    <div class="flex items-center gap-2">
                                        <button type="button" onclick="adjustRatio('negative', -10)" class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 flex items-center justify-center">-</button>
                                        <input type="number" id="negative-ratio" min="0" max="100" step="10" value="20" class="flex-1 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 text-center focus:ring-2 focus:ring-primary" oninput="updateRatioDisplay()"/>
                                        <button type="button" onclick="adjustRatio('negative', 10)" class="w-8 h-8 rounded bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 flex items-center justify-center">+</button>
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">%</span>
                                    </div>
                                </div>
                            </div>

                            <p id="ratio-sum-display" class="text-xs text-center font-medium text-green-600 dark:text-green-400">합계: 100%</p>
                        </div>
                    </div>

                    <!-- 프로그램 선택 모드 -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6 mb-6">
                        <div class="flex gap-6 mb-6">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="program-mode" value="existing" checked onchange="toggleProgramMode()" class="w-4 h-4 text-primary"/>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">기존 프로그램</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="program-mode" value="new" onchange="toggleProgramMode()" class="w-4 h-4 text-primary"/>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">신규 프로그램</span>
                            </label>
                        </div>

                        <!-- 기존 프로그램 선택 -->
                        <div id="existing-program-section">
                            <div class="flex flex-col gap-4">
                                <div class="flex flex-col gap-2">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm font-bold text-gray-900 dark:text-white">프로그램 검색</label>
                                        <span class="text-xs text-gray-500" id="program-list-count">258개 프로그램</span>
                                    </div>
                                    <input type="text" id="program-search" placeholder="프로그램명으로 검색" oninput="filterPrograms()" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-gray-900 dark:text-white">프로그램 선택</label>
                                    <select id="existing-program-select" size="10" onchange="updateSelectedProgramDisplay()" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-2 focus:ring-2 focus:ring-primary text-sm">
                                        <!-- 프로그램 목록이 JavaScript로 채워집니다 -->
                                    </select>
                                    <div id="selected-program-display" class="mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg hidden">
                                        <p class="text-sm text-gray-700 dark:text-gray-300">
                                            <span class="font-semibold">AI로 반응생성하기 위해 선택한 프로그램:</span>
                                            <span id="selected-program-name" class="ml-1 text-primary font-medium"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 신규 프로그램 입력 -->
                        <div id="new-program-section">
                            <div class="flex flex-col gap-4">
                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-gray-900 dark:text-white">프로그램 제목</label>
                                    <input type="text" id="new-program-title" placeholder="예: 추억의 노래 교실" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white h-10 px-3 focus:ring-2 focus:ring-primary"/>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-gray-900 dark:text-white">프로그램 설명</label>
                                    <textarea id="new-program-desc" rows="4" placeholder="프로그램 내용, 사용 도구/재료, 목적, 진행 방식 등을 자세히 입력하세요" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-3 focus:ring-2 focus:ring-primary"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 생성 버튼 -->
                    <div class="flex justify-center mb-6">
                        <button onclick="generateProgramReactions()" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-lg font-semibold text-base shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined">auto_awesome</span>
                            AI로 반응 생성하기
                        </button>
                    </div>

                    <!-- 결과 영역 (3분할) -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-base font-bold text-gray-900 dark:text-white">생성된 반응</h3>
                            <button onclick="copyAllReactions()" class="text-sm text-primary hover:text-primary-dark font-medium flex items-center gap-1">
                                <span class="material-symbols-outlined" style="font-size: 18px;">content_copy</span>
                                전체 복사
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- 긍정 -->
                            <div class="flex flex-col">
                                <div class="bg-green-50 dark:bg-green-900/20 px-3 py-2 rounded-t-lg border-b border-green-200 dark:border-green-800">
                                    <h4 class="text-sm font-bold text-green-800 dark:text-green-300">😊 긍정</h4>
                                </div>
                                <textarea id="positive-reactions" readonly class="w-full h-[400px] resize-none rounded-b-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm p-3 focus:ring-2 focus:ring-primary" placeholder="생성 결과가 여기에 표시됩니다"></textarea>
                            </div>

                            <!-- 중립 -->
                            <div class="flex flex-col">
                                <div class="bg-blue-50 dark:bg-blue-900/20 px-3 py-2 rounded-t-lg border-b border-blue-200 dark:border-blue-800">
                                    <h4 class="text-sm font-bold text-blue-800 dark:text-blue-300">😐 중립</h4>
                                </div>
                                <textarea id="neutral-reactions" readonly class="w-full h-[400px] resize-none rounded-b-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm p-3 focus:ring-2 focus:ring-primary" placeholder="생성 결과가 여기에 표시됩니다"></textarea>
                            </div>

                            <!-- 소극/피로 -->
                            <div class="flex flex-col">
                                <div class="bg-amber-50 dark:bg-amber-900/20 px-3 py-2 rounded-t-lg border-b border-amber-200 dark:border-amber-800">
                                    <h4 class="text-sm font-bold text-amber-800 dark:text-amber-300">😔 소극/피로</h4>
                                </div>
                                <textarea id="negative-reactions" readonly class="w-full h-[400px] resize-none rounded-b-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm p-3 focus:ring-2 focus:ring-primary" placeholder="생성 결과가 여기에 표시됩니다"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner-large"></div>
            <h3 id="loading-title" class="text-lg font-bold text-gray-900 mb-2">처리 중입니다...</h3>
            <p id="loading-message" class="text-sm text-gray-600">잠시만 기다려주세요.</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase 설정 및 인증 -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>

    <!-- 기존 스크립트 -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/program-data.js"></script>
    <script src="js/counseling.js"></script>
    <script src="js/case-management.js"></script>
    <script src="js/monitoring.js"></script>
    <script src="js/vehicle-checker.js"></script>
    <script src="js/main.js"></script>

    <!-- 인증 체크 -->
    <script>
        // Firebase 초기화 및 인증 체크
        document.addEventListener('DOMContentLoaded', () => {
            if (initializeFirebase()) {
                onAuthStateChanged(async (user) => {
                    if (!user) {
                        // 로그인되지 않은 사용자는 로그인 페이지로 리디렉트
                        window.location.href = 'login.html';
                        return;
                    }

                    // 승인 상태 확인
                    const approval = await checkUserApproval(user.uid);
                    if (!approval.approved) {
                        // 승인되지 않은 사용자는 로그인 페이지로 리디렉트
                        alert('관리자의 승인이 필요합니다. 승인 후 이용 가능합니다.');
                        await signOut();
                        window.location.href = 'login.html';
                        return;
                    }

                    // 승인된 사용자: 사용자 정보 표시
                    updateUserDisplay(user, approval.userData);
                });
            }
        });

        // 사용자 정보 표시 업데이트
        function updateUserDisplay(user, userData) {
            // 사용자 이름 표시 (설정 페이지나 헤더에 추가 가능)
            const userName = userData.displayName || user.displayName || user.email;

            // 관리자인 경우 관리자 메뉴 표시
            if (userData.role === 'admin') {
                addAdminMenu();
            }
        }

        // 관리자 메뉴 추가
        function addAdminMenu() {
            const sidebar = document.getElementById('sidebar');
            if (!sidebar) return;

            const adminMenuItem = document.createElement('a');
            adminMenuItem.href = 'admin.html';
            adminMenuItem.className = 'flex items-center gap-4 px-6 py-4 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary font-semibold cursor-pointer relative';
            adminMenuItem.innerHTML = `
                <span class="material-symbols-outlined text-2xl">admin_panel_settings</span>
                관리자 대시보드
            `;

            // 설정 메뉴 위에 추가
            const settingsMenu = sidebar.querySelector('[onclick*="showPage(\'settings\')"]');
            if (settingsMenu) {
                sidebar.insertBefore(adminMenuItem, settingsMenu.parentElement);
            }
        }

        // 로그아웃 기능 (설정 페이지에 추가할 수 있음)
        async function handleLogout() {
            if (confirm('로그아웃하시겠습니까?')) {
                const result = await signOut();
                if (result.success) {
                    window.location.href = 'login.html';
                }
            }
        }
    </script>
</body>
</html>
