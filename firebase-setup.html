<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase 설정 - 주간보호센터 업무수행도우미</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "primary-dark": "#106cc9",
                    },
                    fontFamily: {
                        sans: ["Noto Sans KR", "Inter", "sans-serif"],
                    },
                },
            },
        };
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <!-- 헤더 -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-primary rounded-full mb-4">
                    <span class="material-symbols-outlined text-white text-4xl">settings</span>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">
                    Firebase 초기 설정
                </h1>
                <p class="text-gray-600 text-sm">
                    Firebase Console에서 받은 설정 정보를 입력하세요
                </p>
            </div>

            <!-- 안내 메시지 -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div class="flex gap-3">
                    <span class="material-symbols-outlined text-blue-600 text-xl">info</span>
                    <div class="flex-1 text-sm">
                        <p class="text-blue-900 font-semibold mb-2">설정 방법:</p>
                        <ol class="text-blue-800 space-y-1 list-decimal list-inside">
                            <li><a href="https://console.firebase.google.com/" target="_blank" class="underline hover:text-blue-600">Firebase Console</a>에서 프로젝트 생성</li>
                            <li>프로젝트 설정 → 일반 → "내 앱" → 웹 앱 추가</li>
                            <li>Firebase SDK 구성 정보를 아래 양식에 입력</li>
                            <li>"설정 저장" 버튼 클릭</li>
                        </ol>
                        <p class="text-blue-800 mt-3 font-medium">💡 여러 기기에서 사용하시나요?</p>
                        <p class="text-blue-700">설정을 파일로 저장하여 다른 PC나 브라우저에서 간편하게 가져올 수 있습니다.</p>
                    </div>
                </div>
            </div>

            <!-- 설정 가져오기 -->
            <div class="mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-gray-600">upload_file</span>
                        <span class="text-sm font-medium text-gray-700">이미 설정 파일이 있으신가요?</span>
                    </div>
                    <div>
                        <input type="file" id="configFileInput" accept=".json" class="hidden">
                        <button type="button" onclick="document.getElementById('configFileInput').click()"
                            class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-all flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg">file_upload</span>
                            설정 가져오기
                        </button>
                    </div>
                </div>
            </div>

            <!-- Firebase 설정 폼 -->
            <form id="firebase-setup-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        API Key *
                    </label>
                    <input type="text" id="apiKey" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                        placeholder="AIza...">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Auth Domain *
                    </label>
                    <input type="text" id="authDomain" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                        placeholder="your-project.firebaseapp.com">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Project ID *
                    </label>
                    <input type="text" id="projectId" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                        placeholder="your-project">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Storage Bucket *
                    </label>
                    <input type="text" id="storageBucket" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                        placeholder="your-project.appspot.com">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Messaging Sender ID *
                    </label>
                    <input type="text" id="messagingSenderId" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                        placeholder="123456789">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        App ID *
                    </label>
                    <input type="text" id="appId" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                        placeholder="1:123456789:web:abc123">
                </div>

                <div class="pt-4">
                    <button type="submit"
                        class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined">save</span>
                        설정 저장
                    </button>
                </div>
            </form>

            <!-- 현재 설정 상태 -->
            <div id="current-config" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">현재 저장된 설정:</h3>
                <pre id="config-display" class="text-xs font-mono text-gray-600 overflow-x-auto"></pre>
                <div class="mt-3 flex gap-2">
                    <a href="login.html" class="flex-1 text-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium">
                        로그인 페이지로 이동
                    </a>
                    <button onclick="exportConfig()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium flex items-center gap-1">
                        <span class="material-symbols-outlined text-lg">download</span>
                        내보내기
                    </button>
                    <button onclick="clearConfig()" class="px-4 py-2 border border-gray-300 hover:bg-gray-100 text-gray-700 rounded-lg text-sm font-medium">
                        설정 초기화
                    </button>
                </div>
            </div>

            <!-- 영구 설정 (코드에 넣기) -->
            <div id="permanent-config" class="mt-6 p-4 bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg hidden">
                <div class="flex items-start gap-3 mb-3">
                    <span class="material-symbols-outlined text-purple-600 text-2xl">code</span>
                    <div class="flex-1">
                        <h3 class="text-sm font-bold text-purple-900 mb-1">모든 PC에서 자동으로 사용하기 (권장)</h3>
                        <p class="text-xs text-purple-700 mb-3">아래 코드를 <code class="bg-white px-1 rounded">js/firebase-config.js</code> 파일의 9-16번째 줄에 복사하면 모든 PC와 브라우저에서 자동으로 작동합니다.</p>
                    </div>
                </div>
                <div class="relative">
                    <pre id="code-display" class="text-xs font-mono text-gray-800 bg-white p-3 rounded border border-gray-300 overflow-x-auto"></pre>
                    <button onclick="copyCode()" class="absolute top-2 right-2 px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded text-xs font-medium flex items-center gap-1">
                        <span class="material-symbols-outlined text-sm">content_copy</span>
                        복사
                    </button>
                </div>
                <div class="mt-3 flex items-start gap-2 text-xs text-purple-800">
                    <span class="material-symbols-outlined text-sm">info</span>
                    <p>이 설정은 GitHub에 배포되므로 모든 기기에서 자동으로 적용됩니다. Firebase API Key는 공개되어도 안전합니다.</p>
                </div>
            </div>
        </div>

        <!-- 도움말 -->
        <div class="mt-6 text-center">
            <a href="FIREBASE_SETUP.md" target="_blank" class="text-sm text-gray-600 hover:text-gray-900 underline">
                자세한 설정 가이드 보기
            </a>
        </div>
    </div>

    <script>
        // 페이지 로드 시 현재 설정 확인
        window.addEventListener('DOMContentLoaded', () => {
            loadCurrentConfig();
        });

        // 현재 설정 불러오기
        function loadCurrentConfig() {
            const config = localStorage.getItem('firebaseConfig');
            if (config) {
                try {
                    const parsedConfig = JSON.parse(config);
                    document.getElementById('config-display').textContent = JSON.stringify(parsedConfig, null, 2);
                    document.getElementById('current-config').classList.remove('hidden');

                    // 폼에 현재 값 채우기
                    document.getElementById('apiKey').value = parsedConfig.apiKey || '';
                    document.getElementById('authDomain').value = parsedConfig.authDomain || '';
                    document.getElementById('projectId').value = parsedConfig.projectId || '';
                    document.getElementById('storageBucket').value = parsedConfig.storageBucket || '';
                    document.getElementById('messagingSenderId').value = parsedConfig.messagingSenderId || '';
                    document.getElementById('appId').value = parsedConfig.appId || '';

                    // 코드 생성 영역 표시
                    generateCode(parsedConfig);
                } catch (e) {
                    console.error('설정 로드 실패:', e);
                }
            }
        }

        // JavaScript 코드 생성
        function generateCode(config) {
            const code = `const DEFAULT_FIREBASE_CONFIG = {
    apiKey: "${config.apiKey}",
    authDomain: "${config.authDomain}",
    projectId: "${config.projectId}",
    storageBucket: "${config.storageBucket}",
    messagingSenderId: "${config.messagingSenderId}",
    appId: "${config.appId}"
};`;
            document.getElementById('code-display').textContent = code;
            document.getElementById('permanent-config').classList.remove('hidden');
        }

        // 코드 복사
        function copyCode() {
            const codeText = document.getElementById('code-display').textContent;
            navigator.clipboard.writeText(codeText).then(() => {
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<span class="material-symbols-outlined text-sm">check</span>복사됨!';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            }).catch(err => {
                alert('복사 실패: ' + err);
            });
        }

        // 폼 제출 처리
        document.getElementById('firebase-setup-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const config = {
                apiKey: document.getElementById('apiKey').value.trim(),
                authDomain: document.getElementById('authDomain').value.trim(),
                projectId: document.getElementById('projectId').value.trim(),
                storageBucket: document.getElementById('storageBucket').value.trim(),
                messagingSenderId: document.getElementById('messagingSenderId').value.trim(),
                appId: document.getElementById('appId').value.trim()
            };

            // LocalStorage에 저장
            localStorage.setItem('firebaseConfig', JSON.stringify(config));

            // 성공 메시지
            alert('✓ Firebase 설정이 저장되었습니다!\n\n이제 로그인 페이지로 이동하여 회원가입을 진행하세요.');

            // 현재 설정 표시
            loadCurrentConfig();
        });

        // 설정 초기화
        function clearConfig() {
            if (confirm('저장된 Firebase 설정을 삭제하시겠습니까?')) {
                localStorage.removeItem('firebaseConfig');
                document.getElementById('current-config').classList.add('hidden');
                document.getElementById('permanent-config').classList.add('hidden');
                document.getElementById('firebase-setup-form').reset();
                alert('설정이 초기화되었습니다.');
            }
        }

        // 설정 내보내기 (JSON 파일 다운로드)
        function exportConfig() {
            const config = localStorage.getItem('firebaseConfig');
            if (!config) {
                alert('저장된 설정이 없습니다.');
                return;
            }

            try {
                // JSON 파일 생성
                const blob = new Blob([config], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                // 다운로드 링크 생성 및 클릭
                const a = document.createElement('a');
                a.href = url;
                a.download = 'firebase-config.json';
                document.body.appendChild(a);
                a.click();

                // 정리
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('✓ 설정 파일이 다운로드되었습니다!\n\n다른 PC나 브라우저에서 "설정 가져오기" 버튼을 사용하여 이 파일을 불러오세요.');
            } catch (e) {
                console.error('설정 내보내기 실패:', e);
                alert('설정 내보내기에 실패했습니다.');
            }
        }

        // 설정 가져오기 (JSON 파일 업로드)
        document.getElementById('configFileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // JSON 파일인지 확인
            if (!file.name.endsWith('.json')) {
                alert('JSON 파일만 업로드할 수 있습니다.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    // JSON 파싱 및 검증
                    const config = JSON.parse(event.target.result);

                    // 필수 필드 확인
                    const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
                    const missingFields = requiredFields.filter(field => !config[field]);

                    if (missingFields.length > 0) {
                        alert('유효하지 않은 설정 파일입니다.\n누락된 필드: ' + missingFields.join(', '));
                        return;
                    }

                    // localStorage에 저장
                    localStorage.setItem('firebaseConfig', JSON.stringify(config));

                    // 폼 및 화면 업데이트
                    loadCurrentConfig();

                    alert('✓ 설정을 성공적으로 가져왔습니다!\n\n이제 로그인 페이지로 이동하여 사용할 수 있습니다.');
                } catch (e) {
                    console.error('설정 가져오기 실패:', e);
                    alert('설정 파일을 읽는데 실패했습니다.\n올바른 JSON 파일인지 확인하세요.');
                }
            };

            reader.readAsText(file);

            // 파일 입력 초기화 (같은 파일을 다시 선택할 수 있도록)
            e.target.value = '';
        });
    </script>
</body>
</html>
